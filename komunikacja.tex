\chapter{Komunikacja z urządzeniami pomiarowymi przy wykorzystaniu oprogramowania open source}
\section{Oprogramowanie open source}
Otwarte oprogramowanie (ang. \textit{open source}) jest licencją która dopuszcza darmowe i zgodne z prawem kopiowania oraz
używania programów napisanych przez innych użytkowników.
Przykładami oprogramowania Open Source są:
\begin{itemize}
\item System Linux (Ubuntu) --- jest systemem operacyjny często wykorzystywanym w nauce.
\item Język programowania Python --- jezyk obiektowy programowania wysokiego poziomu rozpowszechniany na licencji Open Source.
\end{itemize}
\section{Python}
Język Python posiada wiele bibliotek naukowych oraz systemowych, które można zastosować do komunikacji ze sprzętem pomiarowym.
Posiada łatwą składnię, dzięki czemu jest łatwy w nauce, a programy pisane w nim są przejrzyste.
Python jest często używany w nauce m.in. w eksperymencie mający za cel znalezienie fal grawitacyjnych.
W mojej pracy wykorzystywałem ten język zarówno do pisania skryptów mających na celu komunikacje i sterowaniem sprzętem laboratoryjnym,
jak i wykorzystywałem do analizy danych uzyskanych w wyniku pomiarów.
Najważniejsze biblioteki, których użyłem do swoich celów to:
\begin{itemize}
\item $\mathtt{Matplotlib}$ ~\cite{matplotlib_book} --- bibliotek do sporządzania wykresów, posiada między innymi możliwość używania symboli \LaTeX.
Możliwość wykonywania animacji co używane do robienia wykresów w czasie rzeczywistym.
\item $\mathtt{Scipy}$ ~\cite{SciPy_book} --- bibliotek do obliczeń numerycznych. Funkcje z niej uzywałem w celu dopasowywania
fukcji dla zebranych danych aby wyznaczyć wartość prądu progowego oraz sprawności.
\item $\mathtt{OS}$ --- biblioteka systemowa. Używana w celu komunikacji ze sprzętem pomiarowym za pomocą wywołań systemowych.
\item $\mathtt{PyQt5}$ --- biblioteka do tworzenia graficznego interfejsu. Użyłem ją aby stworzyć interfejs graficzny za pomocą,
którego możliwe jest sterowanie sprzętem oraz wykonywanie pomiarów charakterystyk laserów półprzewodnikowych
\item $\mathtt{Threading}$ --- biblioteka do tworzenia wątków. Używam jej do robienia wykresów w czasie rzeczywistym.
W tym celu potrzebowałem jeden wątek, do komunikuje ze sprzętem, a drugi w tym samym czasie
na podstawie zebranych danych tworzył wykres w czasie rzeczywistym.
\end{itemize}
Połączenie bibliotek wymienionych powyżej umożliwiło stworzenia programu, który komunikuje i steruje sprzętem.
Warto jeszcze nadmienić, że aktualnie rozwijane są dwie wersję Python: Python 2.7 i Python 3. Większą przyszłość ma Python 3,
więc skrypty do analizy danych były pisane w nim. Jednakże biblioteka matplotlib i PyQt5 na chwilę pisania mojej
pracy lepiej współpracowała z Python 2.7.
\section{Programowane urządzenia pomiarowe}
Przez programowane urządzenia pomiarowe rozumiemy sprzęt mogący dokonywać pomiarów wielkości elektrycznych i nieelektrycznych,
który wyposzażony jest w interfejs umożliwiający sterowanie nimi przy pomocy komputera. Przykładami takich urządzeń, którymi zajmuje się w swojej pracy są:
\begin{itemize}
\item Zasilacza diód laserowych firmy Thorlabs model LDC4005.
\item Miernik mocy firmy Thorlas firmy Thorlabs model PM100.
\end{itemize}
Z wyżej wymienionymi urządzeniami możliwa jest fizyczna komunikacja za pomocą interfejsu USB przy pomocy standardu komend SCPI,
który zostanie opiszany w dalszej cześci rozdziału.

\section{Komunikacja}
Podstawową zasadą w systemie Linux mówi, że wszystko jest plikiem. Linuksowy sterownik znakowy (ang. \textit{char driver})
pozwala na reprezentowanie urządzenia za pomocą specjalnych plików wirtualnych, które znajdują się w przestrzeni
użytkownika w katalogu $\mathtt{/dev/<nazwa>}$. Obsługa tych plików możliwa jest za pomocą wywołań systemowych (ang. \textit{system call}),
które stanowią API, za pomocą którego użytkowniki może sterować sprzętem. Do używania wywołań systemowych potrzebny jest
identyfikator danego urządzenia, który jest reprezentowany przez deskryptor pliku, będący liczbą całkowitą.
Podstawowe wywołaniami systemowymi pozwalające na sterowanie sprzętem to:
\begin{itemize}
\item $\mathtt{open}$ --- służy do połaczenia z urządzeniem, zwraca deskrypotor pliku.
\item $\mathtt{write}$ --- funkcja służaca do wysyłania komend do urządzenia .
\item $\mathtt{read}$ --- funckja służąca do odczytywania buffora urządzenia.
\item $\mathtt{close}$ --- funkcja zamykająca połączenie.
\end{itemize}
Funkcję te mają swoją implementację w języku C w bibliotece $<\mathtt{fcntl.h}>$ oraz $<\mathtt{unistd.h}>$, oraz w języku Python w bibliotece $\mathtt{os}$.
\section{SCPI --- standard komend do komunikacji z urządzeniami}
SCPI (ang. \textit{Standard Commands for Programmable Instruments}) jest tekstowym interfejsem ASCII do programowanych
urządzeń pomiarowych mający na celu standaryzacje polecenie używanych w systemach pomiarowym. Zdefiniowany został 1990 roku,
wedle specyfikacji IEEE 488.2. (Institute of Electrical and Electronics Engineers) --- międzynarodowa organizacja stowarzyszeń
inżynierów elektryków i elektroników. Dzięki temu możliwa jest obsługa urządzeń pomiarowych przy wykorzystaniu komputera.
Polecenia SCPI są to ciągi tekstowe ASCII, które są wysyłane do urządzenia przez wywołanie systemowe $\mathtt{write}$.
Polecenia są serią jednego lub więcej słów, przy czym wiele z nich używa dodatkowych parametrów.
Odpowiedź do zapytania zazwyczaj zwracana jest w postaci ciągu ASCII.
W przypadku danych masowych mogą być zwracane także formaty binarne. \\

Cechą poleceń SCPI jest ich implementacja przez każde urządzenie, czyli to samo polecenie będzie działać na każdym oscyloskopie
bez względu na producenta. Można wyróżnić dwie grupy poleceń:
\begin{itemize}
\item Polecenia dla każdego urządzenia pomiarowego nie zależnie od jego przeznacznia. Takimi komendami są m.in.
\begin{itemize}
\item $\mathtt{*idn?}$ --- odczytuje identyfikator urządzenia.
\item $\mathtt{*rst}$ --- powoduje przywrócenie ustawień początkowych urządzenia.
\item $\mathtt{*cls}$ --- powoduje wyzerowanie informacji o błędach.
\item $\mathtt{*opc?}$ --- (ang. operation complete) jest zapytanie o zakończenie wykonania
poprzedzających poleceń. \\
W odpowiedzi na zapytanie po zakończeniu wykonywania poprzedzających poleceń urządzenie prześle wartość 1.
\item $\mathtt{*wai}$ --- (ang. wait) oczekiwanie na zakończenie wykonania poprzedzających poleceń.
\end{itemize}

\item Polecenia charakterystyczne dla danego urządzenia pomiarowego zgodnie z jego przeznaczeniem.
Przykładowe polecenie które będzie działać na każdym zasilaczu korzystającym z standardu SCPI:
\begin{itemize}
\item Służacę do ustawienie wartości prądu na 0.01\,A \\ $\mathtt{SOURce:CURRent:LEVel:AMPLitude}$ $\mathtt{0.01}$
\end{itemize}
\end{itemize}

Fizyczne łącze komunikacyjne nie jest zdefiniowane przez SCPI. Stworzony standard IEEE-488 był dla GPIB,
ale może być również używany z interfejsem RS-232, Ethernet, USB. W przypadku mojej pracy do komunikacji ze sprzętem
używam USB.
\newpage